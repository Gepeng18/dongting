近年来，固态硬盘（SSD）的快速进步和普及已对IO密集程序的开发产生了深远影响。然而，许多程序依然沿用上个世纪遗留下来的开发方法。我们需要重新审视开发策略，以便更有效地利用现代硬件的性能。
我们可以先大致了解一下20年来硬件发展。同一时期不同档次的硬件也会有很大的性能差异，以下列举的数字只是大概的典型值。
先看CPU，最近20年，CPU的时钟频率只从2GHz增加到5GHz，大概2.5倍，同频性能有很大的提高，但更多的提升来自于核心数的暴增，典型的服务器都是几十上百个核心了。当前CPU典型频率3GHz，通常服务器频率略低，一个时钟周期大概是0.33纳秒。现代CPU通常有3级缓存，这3级缓存的典型延迟分别大约是1、3、11纳秒。其中第三级缓存可能是所有核心共享的，但如果服务器上有多个CPU的话，就无法做到L3共享了。
内存性能的提升不如CPU那么大，20年来性能提升不到10倍，内存换代的时候延迟甚至还会增加点。当前典型内存拷贝吞吐约50GB/S，延迟65纳秒。由于内存性能（特别是延迟）提升不大，CPU一直在加大缓存容量。
机械硬盘的性能提升是最小的，20年来寻道时间（影响延迟）几乎不变，主要的提升是容量，缓存大了一点，但是击穿这点缓存变成随机读太容易了。机械硬盘4KB随机读写IOPS只有几百，相当于1~2MB/S，顺序读写吞吐约200MB/S，企业级硬盘典型随机读延迟4毫秒。
可以看到，就算不考虑CPU缓存，纯内存的吞吐也比机械硬盘顺序吞吐快250倍，比随机访问快25000倍，延迟相差6万倍。以前的程序会极力避免IO操作，想方设法把磁盘随机访问变成顺序访问，因为磁盘和内存的性能差距太大了。
现在，内存和磁盘之间又插入了一个SSD，它的普及极大地缩小了存储设备和内存的性能差异。当前SSD典型顺序吞吐7GB/S，4K随机IOPS100万/S（相当于4GB/S），读延迟50微秒，写延迟20微秒。可以看到SSD随机访问和顺序访问性能差不了太多，顺序吞吐能力已经接近内存的量级了（相差7倍），主要差异体现在延迟方面，和内存相比仍有近千倍的差异。
SSD的普及得益于最近这些年价格的急速下降，我自己在今年（2023）6月就买了一块，2TB，顺序读写速度约7GB/S，4KB随机读100万/S，4KB随机写70万/S，价格是469元（某三线品牌中端产品，不是什么高档货，但这价格还能说啥，要性能还有更好的），已经和同等容量机械硬盘价格差不多了。如果你现在开始开发一个全新的系统，可以考虑不为机械硬盘做任何优化。
在使用SSD的场景下，开发策略也要有所改变。第一，由于随机访问和顺序访问差不了太多，现在合并IO更多从CPU占用来考虑。一次读取100KB和分100次读取1KB，对CPU的负担肯定是不一样的，IO操作都会涉及用户态内核态模式切换，如果能合并让IO次数少一点，还是有益处的。
第二，SSD大幅提升了存储的IO能力，系统瓶颈就开始转移到其它地方。除了CPU，大量数据操作时，网络IO，内存访问，都可能成为瓶颈。这是dongting项目从网络rpc开始开发，并且格外注重减少内存拷贝的原因。
第三，要特别注意延迟的影响。SSD延迟和内存相比仍相差近千倍，虽然整个SSD盘的IOPS可以达到100万，但如果单个线程同步操作，50微秒的延迟就决定了TPS不会超过2万。要解决这个问题，要么多开几个线程，要么一个线程使用非堵塞IO或异步IO同时写多个数据块（需要更多的内存做buffer）。这一点现在dongting项目中也还有两个地方没有优化。
说到延迟还有个特别需要注意的地方，现在很多程序都运行在云上，使用的很可能是云盘。云盘的发展也依赖于网络技术的进步，当前普通服务器上25Gbps（注意需要除以8）的网卡已经比较普及了，100Gbps乃至更高的速率也是有的，在延迟方面，同一个房间内的设备延迟可以做到50微秒以内甚至更低，网络的带宽、延迟和本地SSD相比大致是一个级别的了。由于云盘还有额外的封装，再加上网络拓扑的复杂性，导致不确定因素就更多。所以，如果程序运行在云上，要考虑IO延迟可能会大不少，甚至因为网络拥塞而不太稳定。
最后说个题外话，现在，某公有云（其它云也类似吧）上面，大部分云盘标的随机写延迟为200微秒（也有延迟更低的，花钱来买），大概是本地ssd的10倍，增加一块2TB的云盘，10万IOPS，200微秒的写延迟，每年价格就多了8万多元，这价格简直要上天，作为对比，前面我买的SSD，469元2T，20微秒写延迟，100万读IOPS。当然家用产品没法和企业产品比，后者有多副本、弹性伸缩、9个9的数据可靠性等等。但当年EMC大概也是这么说的，然后就被去IOE了，初创不久的互联网企业用廉价的X86服务器，MySQL数据库等，替换了昂贵的IBM服务器、Oracle数据库，EMC存储，并证明了新模式的可靠性。现在他们变成了云厂商，用不知道多少倍的价格卖云盘给我们:-)
想要更高的性价比，在云上也有更好的选择，比如拥有本地SSD的云服务器实例，性能更高，延迟更低，同时只有云盘大概1/7的价格（还是比自己组装贵一个数量级）。本地SSD的缺点就是要自己处理故障，以及不能弹性伸缩了。
到这里就要谈一下，dongting项目的一个目的，就是要提供故障处理、以及弹性伸缩的基础能力支持。dongting-raft提供了multi-raft，动态添加raft group等能力，可用于构建数据的自动冗余、弹性伸缩动态调度等，因为是零依赖，非常适合作为基础组件的基础组件，不管是IDC内的自动failover、同城容灾还是异地多活，dongting-raft都可以助力在廉价硬件的基础上，低成本构建健壮的分布式应用。